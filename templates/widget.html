{% extends 'parts/base.html' %}

<!-- Content Start -->
{% block content %}
<div class="content">


    <!-- Navbar Start -->
    <nav class="navbar navbar-expand bg-secondary navbar-dark sticky-top px-4 py-0">
        <a href="#" class="sidebar-toggler flex-shrink-0">
            <i class="fa fa-bars" style="color: #FFFF;"></i>
        </a>

        <div class="navbar-nav align-items-center ms-auto">
            <div class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                    <i class="fa fa-bell me-lg-2"></i>
                    <span class="d-none d-lg-inline-flex">Notificatin</span>
                </a>
                <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
                    <a href="#" class="dropdown-item">
                        <h6 class="fw-normal mb-0">Profile updated</h6>
                        <small>15 minutes ago</small>
                    </a>
                    <hr class="dropdown-divider">
                    <a href="#" class="dropdown-item">
                        <h6 class="fw-normal mb-0">New user added</h6>
                        <small>15 minutes ago</small>
                    </a>
                    <hr class="dropdown-divider">
                    <a href="#" class="dropdown-item">
                        <h6 class="fw-normal mb-0">Password changed</h6>
                        <small>15 minutes ago</small>
                    </a>
                    <hr class="dropdown-divider">
                    <a href="#" class="dropdown-item text-center">See all notifications</a>
                </div>
            </div>
        </div>
    </nav>
    <!-- Navbar End -->


    <!-- Widget Start -->
    <div class="container-fluid pt-4 px-4">
        <div class="row g-4">
            <!-- 選股推薦 -->
            <div class="col-12">
                <div class="bg-secondary rounded h-100 p-4">
                    <h2 >選股推薦</h2>
                </div>
            </div>

            <div class="col-12">
                <div class="bg-secondary rounded h-100 p-4 ">
                    
                    <div class="nav" >
                        
                        <button id="SP_01" class=" p-3 nav-link btn btn-outline-warning m-2" type="button" data-bs-toggle="pill"
                            data-bs-target="#v-pills-settings"  role="tab"
                            aria-controls="v-pills-settings" aria-selected="false" onclick ="return check_stock20();" >投信購買標的</button>
                            
                        <button id="SP_02" class="nav-link p-3 btn btn-outline-warning m-2" id="v-pills-profile-tab" data-bs-toggle="pill"
                            data-bs-target="#v-pills-profile" type="button" role="tab"
                            aria-controls="v-pills-profile" aria-selected="false" onclick ="return check_Turnover20();">週轉率</button>

                        <button class="nav-link p-3 btn btn-outline-warning m-2" id="v-pills-home-tab" data-bs-toggle="pill"
                            data-bs-target="#v-pills-home" type="button" role="tab"
                            aria-controls="v-pills-home" aria-selected="true">波動收縮規律</button>
                            
                        <button class="nav-link p-3 btn btn-outline-warning m-2" id="v-pills-messages-tab" data-bs-toggle="pill"
                            data-bs-target="#v-pills-messages" type="button" role="tab"
                            aria-controls="v-pills-messages" aria-selected="false">技術指標</button>

                        <button class="nav-link p-3 btn btn-outline-warning m-2" id="v-pills-recommend_5-tab" data-bs-toggle="pill"
                            data-bs-target="#v-pills-recommend_5" type="button" role="tab"
                            aria-controls="v-pills-recommend_5" aria-selected="false">型態學</button>
                    </div>
                    
                </div>
            </div>

            <!-- 選股表格 -->
            <div class="col-12 tab-content align-items-start ">
                <!-- 投信購買標的 -->
                <div class="bg-secondary rounded tab-pane fade p-4 " id="v-pills-settings" role="tabpanel" >
                    <div class="alert alert-light mb-4" role="alert">
                        -依照「投信購買標的」提供投資人購買方向。
                    </div>
                    <table id="stock20_from" class="table table-bordered border-light mb-0" style="text-align: center; line-height:35px;">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">排名</th>
                                <th scope="col">代號</th>
                                <th scope="col">名稱</th>
                                <th scope="col">成交</th>
                                <th scope="col">漲跌價</th>
                                <th scope="col">漲跌幅</th>
                                <th scope="col">成交張數</th>
                                <th scope="col">法人買賣日期</th>
                                <th scope="col">投信買進張數</th>
                                <th scope="col">投信賣出張數</th>
                                <th scope="col">投信買賣超張數</th>
                                <th scope="col">法人買賣超註記</th>
                            </tr>
                        </thead>
                        <tbody id="tb">

                        </tbody>
                    </table>
                </div>
                <!-- 周轉率 -->
                <div class="bg-secondary rounded tab-pane fade p-4" id="v-pills-profile" role="tabpanel" >
                    <div class="alert alert-info mb-4" role="alert">
                        -依照「週轉率排行」提供當沖族群週轉率較高較適合當沖標的。
                    </div>
                    <table id="Turnover20_from" class="table table-bordered border-light mb-0" style="text-align: center; line-height:35px;">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">排名</th>
                                <th scope="col">代號</th>
                                <th scope="col">名稱</th>
                                <th scope="col">成交</th>
                                <th scope="col">漲跌價</th>
                                <th scope="col">漲跌幅</th>
                                <th scope="col">更新日期</th>
                                <th scope="col">當日成交量週轉率</th>
                                <th scope="col">2日累計成交量週轉率</th>
                                <th scope="col">3日累計成交量週轉率</th>
                                <th scope="col">5日累計成交量週轉率</th>
                            </tr>
                        </thead>
                        <tbody id="tb">
                        </tbody>
                    </table>
                </div>

                <div class="bg-secondary rounded tab-pane fade show p-4" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">
                    <div class="alert alert-warning mb-4" role="alert">
                        -依照 VCP「波動收縮規律」設定參數，間接從台灣股市挑選出中長線股票。
                    </div>
                    <table class="table table-bordered border-light text-light mb-0">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">股票代號</th>
                                <th scope="col">股價</th>
                                <th scope="col">漲跌</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">1</th>
                                <td>2330.tw</td>
                                <td>469</td>
                                <td>4.33815</td>
                            </tr>
                            <tr>
                                <th scope="row">2</th>
                                <td>2331.tw</td>
                                <td>20</td>
                                <td>3.09279</td>
                            </tr>
                            <tr>
                                <th scope="row">3</th>
                                <td>2332.tw</td>
                                <td>15.25</td>
                                <td>0.328949</td>
                            </tr>
                            <!-- <tr>
                                <th scope="row">4</th>
                                <td>2337.tw</td>
                                <td>29.3</td>
                                <td>0</td>
                            </tr> -->
                        </tbody>
                    </table>
                </div>

                <div class="bg-secondary rounded tab-pane fade p-4" id="v-pills-messages" role="tabpanel" aria-labelledby="v-pills-messages-tab">
                    <div class="alert alert-success mb-4" role="alert">
                        -依照「技術指標」提供喜好運用KD、MACD、RSI 作為買入或賣出的基準。
                    </div>
                    <table class="table table-bordered border-light mb-0">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">股票代號</th>
                                <th scope="col">股價</th>
                                <th scope="col">漲跌</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">1</th>
                                <td>2330.tw</td>
                                <td>469</td>
                                <td>4.33815</td>
                            </tr>
                            <tr>
                                <th scope="row">2</th>
                                <td>2331.tw</td>
                                <td>20</td>
                                <td>3.09279</td>
                            </tr>
                            <tr>
                                <th scope="row">3</th>
                                <td>2332.tw</td>
                                <td>15.25</td>
                                <td>0.328949</td>
                            </tr>
                            <!-- <tr>
                                <th scope="row">4</th>
                                <td>2337.tw</td>
                                <td>29.3</td>
                                <td>0</td>
                            </tr> -->
                        </tbody>
                    </table>
                </div>

                <div class="bg-secondary rounded tab-pane fade p-4" id="v-pills-recommend_5" role="tabpanel" aria-labelledby="v-pills-recommend_5-tab">
                    <div class="alert alert-danger mb-4" role="alert">
                        --依照「型態學」如：兩陽夾一陰、紅三兵、晨星與夜星…等等。
                    </div>
                    <table class="table table-bordered border-light mb-0">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">股票代號</th>
                                <th scope="col">股價</th>
                                <th scope="col">漲跌</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="">1</th>
                                <td>2330.tw</td>
                                <td>469</td>
                                <td>4.33815</td>
                            </tr>
                            <tr>
                                <th scope="row">2</th>
                                <td>2331.tw</td>
                                <td>20</td>
                                <td>3.09279</td>
                            </tr>
                            <tr>
                                <th scope="row">3</th>
                                <td>2332.tw</td>
                                <td>15.25</td>
                                <td>0.328949</td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 熱度圖 -->
            <div class="col-12">
                <div class="bg-secondary rounded h-100 p-4">
                    <h2 >熱度圖</h2>
                    <img src="/static/img/SP.jpg" class="col-12">
                </div>
            </div>
            
        </div>
    </div>
    <!-- Widget End -->


    <!-- Footer Start -->
    <div class="container-fluid pt-4 px-4">
    <div class="bg-secondary rounded-top p-4">
        <div class="row">
            <div class="col-12 col-sm-6 text-center text-sm-start">
                &copy; <a href="#">BDSE25</a>第四組. 
            </div>
        </div>
    </div>
    </div>
    <!-- Footer End -->
</div>
{% endblock %}
<!-- Content End -->

{% block script %}
<script>
// 設定計數器cont 讓它不要重複執行抓取表格
let cont = 0;
function check_stock20(){
    console.log(cont);
    // $("#tb").html("");
    
    if(cont == 0){
    cont ++;
    
    $.ajax({
        type: "post", // 以post方式發起請求
        url: "/SPK_1", // 你的請求鏈接
        data:$().serialize(), 
        beforeSend: function () {
            // 禁用按鈕防止重複提交
            document.querySelector("#SP_01").textContent = '讀取中請稍後';
            $("#SP_01").attr({ disabled: "disabled" });
        },
        success(data){                          
            var data = eval(data);
            // 抓取要寫入的格
            var stock20 = document.getElementById('stock20_from'); 
            // 呼叫建立資料方法 
            getDataRow(data);        

            function getDataRow(data){ 
                // console.log(data);
                for(var i = 0; i < 21; i++){
                    var row = document.createElement('tr'); //建立row 

                    var ACell = document.createElement('td'); //建立第一列
                    ACell.innerText = data[i]['排  名']; //設定資料
                    row.appendChild(ACell);//加入資料

                    var BCell = document.createElement('td'); //建立第2列 
                    var to_nameCell = document.createElement('a'); //建立a標籤
                    var to_nameText = document.createTextNode(data[i]['代號']+'.tw'); //建立a標籤文字

                    to_nameCell.setAttribute('href','/'+'SP_01/'+data[i]['代號']); //將href加入標籤
                    to_nameCell.setAttribute('class','btn-outline-warning'); //將href加入標籤
                    to_nameCell.appendChild(to_nameText); //將文字append到標籤

                    BCell.appendChild(to_nameCell); //將標籤append到td
                    row.appendChild(BCell); //將td append到 tr

                    var CCell = document.createElement('td');//建立第3  
                    CCell.innerHTML = data[i]['名稱'];
                    row.appendChild(CCell); 

                    var DCell = document.createElement('td');//建立第4 
                    DCell.innerHTML = data[i]['成交'];
                    row.appendChild(DCell); 
                    var ECell = document.createElement('td');//建立第5
                    ECell.innerHTML = data[i]['漲跌  價']; 
                    row.appendChild(ECell); 
                    var FCell = document.createElement('td');//建立第6
                    FCell.innerHTML = data[i]['漲跌  幅'];
                    row.appendChild(FCell); 
                    var GCell = document.createElement('td');//建立第7
                    GCell.innerHTML = data[i]['成交  張數'];
                    row.appendChild(GCell); 
                    var HCell = document.createElement('td');//建立第8
                    HCell.innerHTML = data[i]['法人  買賣  日期'];
                    row.appendChild(HCell); 
                    var ICell = document.createElement('td');//建立第9
                    ICell.innerHTML = data[i]['投信  買進  張數'];
                    row.appendChild(ICell); 
                    var JCell = document.createElement('td');//建立第10
                    JCell.innerHTML = data[i]['投信  賣出  張數'];
                    row.appendChild(JCell); 
                    var KCell = document.createElement('td');//建立第11
                    KCell.innerHTML = data[i]['投信  買賣超  張數'];
                    row.appendChild(KCell); 
                    var LCell = document.createElement('td');//建立第11
                    LCell.innerHTML = data[i]['法人  買賣超  註記'];
                    row.appendChild(LCell); 
                    console.log(row);
                stock20.appendChild(row); 
                document.querySelector("#SP_01").textContent = '投信購買標的';
                $("#SP_01").removeAttr("disabled");
                }
            }}
        })
    }else{
        document.querySelector("#SP_01").textContent = '投信購買標的';
        $("#SP_01").removeAttr("disabled");
    }
    return false;
}
</script>

<!-- Turnover標的 -->
<script>
// 設定計數器cont 讓它不要重複執行抓取表格
let cont_02 = 0;
function check_Turnover20(){
    console.log(cont_02);
    // $("#tb").html("");
    
    if(cont_02 == 0){
    cont_02 ++;
    
    $.ajax({
        type: "post", // 以post方式發起請求
        url: "/SPK_2", // 你的請求鏈接
        data:$().serialize(), 
        beforeSend: function () {
            // 禁用按鈕防止重複提交
            document.querySelector("#SP_02").textContent = '讀取中請稍後';
            $("#SP_02").attr({ disabled: "disabled" });
        },
        success(data){                          
            var data = eval(data);
            // 抓取要寫入的格
            var Turnover20 = document.getElementById('Turnover20_from'); 
            // 呼叫建立資料方法 
            getDataRow(data);        

            function getDataRow(data){ 
                // console.log(data);
                for(var i = 0; i < 21; i++){
                    var row = document.createElement('tr'); //建立row 

                    var ACell = document.createElement('td'); //建立第一列
                    ACell.innerText = data[i]['排  名']; //設定資料
                    row.appendChild(ACell);//加入資料

                    var BCell = document.createElement('td'); //建立第2列 
                    var to_nameCell = document.createElement('a'); //建立a標籤
                    var to_nameText = document.createTextNode(data[i]['代號']+'.tw'); //建立a標籤文字

                    to_nameCell.setAttribute('href','/'+'SP_02/'+data[i]['代號']); //將href加入標籤
                    to_nameCell.setAttribute('class','btn-outline-warning'); //將href加入標籤
                    to_nameCell.appendChild(to_nameText); //將文字append到標籤

                    BCell.appendChild(to_nameCell); //將標籤append到td
                    row.appendChild(BCell); //將td append到 tr

                    var CCell = document.createElement('td');//建立第3  
                    CCell.innerHTML = data[i]['名稱'];
                    row.appendChild(CCell); 
                    var DCell = document.createElement('td');//建立第4 
                    DCell.innerHTML = data[i]['成交'];
                    row.appendChild(DCell); 
                    var ECell = document.createElement('td');//建立第5
                    ECell.innerHTML = data[i]['漲跌  價']; 
                    row.appendChild(ECell); 
                    var FCell = document.createElement('td');//建立第6
                    FCell.innerHTML = data[i]['漲跌  幅'];
                    row.appendChild(FCell); 
                    var GCell = document.createElement('td');//建立第7
                    GCell.innerHTML = data[i]['更新  日期'];
                    row.appendChild(GCell); 
                    var HCell = document.createElement('td');//建立第8
                    HCell.innerHTML = data[i]['當日  成交量  週轉率  (%)']+'%';
                    row.appendChild(HCell); 
                    var ICell = document.createElement('td');//建立第9
                    ICell.innerHTML = data[i]['2日  累計  成交量  週轉率']+'%';
                    row.appendChild(ICell); 
                    var JCell = document.createElement('td');//建立第10
                    JCell.innerHTML = data[i]['3日  累計  成交量  週轉率']+'%';
                    row.appendChild(JCell); 
                    var KCell = document.createElement('td');//建立第11
                    KCell.innerHTML = data[i]['5日  累計  成交量  週轉率']+'%';
                    row.appendChild(KCell); 
                    console.log(row);
                Turnover20.appendChild(row); 
                document.querySelector("#SP_02").textContent = '週轉率';
                $("#SP_02").removeAttr("disabled");
                }
            }}
        })
    }else{
        document.querySelector("#SP_02").textContent = '週轉率';
        $("#SP_02").removeAttr("disabled");
    }
    return false;
}
</script>
{% endblock %}