<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>DarkPan - Bootstrap 5 Admin Template</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="/static/img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Roboto:wght@500;700&display=swap" rel="stylesheet"> 
    
    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="/static/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="/static/lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="/static/css/style.css" rel="stylesheet">

    <!-- Flask -->
    <script src="https://cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js"></script>

</head>

<body>
    <div class="container-fluid position-relative d-flex p-0">
        <!-- Spinner Start -->
        <div id="spinner" class="show bg-dark position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <!-- Spinner End -->


        <!-- Sidebar Start -->
        <div class="sidebar pe-4 pb-3">
            <nav class="navbar bg-secondary navbar-dark">
                <a href="/templates/index.html" class="navbar-brand mx-4 mb-3">
                    <h3 class="text-primary"><img class="fa me-2" src="/static/img/EZ-GU.png"></i>EZ-GU</h3>
                </a>
                <!-- <div class="d-flex align-items-center ms-4 mb-4">
                    <div class="position-relative">
                        <img class="rounded-circle" src="/static/img/user.jpg" alt="" style="width: 40px; height: 40px;">
                        <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1"></div>
                    </div>
                    <div class="ms-3">
                        <h6 class="mb-0">Jhon Doe</h6>
                        <span>Admin</span>
                    </div>
                </div> -->
                <div class="navbar-nav w-100">
                    <a href="/" class="nav-item nav-link"><i class="fa fa-chart-bar me-2"></i>七大指標</a>
                    <a href="/widget" class="nav-item nav-link"><i class="fa fa-th me-2"></i>選股推薦</a>
                    <a href="/form" class="nav-item nav-link"><i class="fa fa-keyboard me-2"></i>投資組合評估</a>
                    <!-- <a href="/chart" class="nav-item nav-link"><i class="fa fa-tachometer-alt me-2"></i>Charts</a> -->
                    <a href="/table" class="nav-item nav-link active"><i class="fa fa-table me-2"></i>資料集</a>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="fa fa-laptop me-2"></i>Elements</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="/button" class="dropdown-item">Buttons</a>
                            <a href="/typography" class="dropdown-item">Typography</a>
                            <a href="/element" class="dropdown-item">Other Elements</a>
                        </div>
                    </div>
                    <!-- <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="far fa-file-alt me-2"></i>Pages</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="/templates/parts/signin.html" class="dropdown-item">Sign In</a>
                            <a href="/templates/parts/signup.html" class="dropdown-item">Sign Up</a>
                            <a href="/templates/parts/404.html" class="dropdown-item">404 Error</a>
                            <a href="/templates/parts/blank.html" class="dropdown-item">Blank Page</a>
                        </div>
                    </div> -->
                </div>
            </nav>
        </div>
        <!-- Sidebar End -->


        <!-- Content Start -->
        <div class="content">
            <!-- Navbar Start -->
            <nav class="navbar navbar-expand bg-secondary navbar-dark sticky-top px-4 py-0">
                <a href="/templates/index.html" class="navbar-brand d-flex d-lg-none me-4">
                    <h2 class="text-primary mb-0"><i class="fa fa-user-edit"></i></h2>
                </a>
                <a href="#" class="sidebar-toggler flex-shrink-0">
                    <i class="fa fa-bars"></i>
                </a>
                <!-- 搜尋欄 -->
                <form class="d-none d-md-flex ms-4" name="search_from" onsubmit="return check_search_from()">
                    <!-- <input class="form-control bg-dark border-0" type="search" placeholder="Search"> -->
                    <input class="form-control bg-dark border-0" type="text" placeholder="EX：2330" name="q" aria-label="Search" >
                    <button class="btn my-2 my-sm-0" type="submit">Search</button>
                </form>
                <div class="navbar-nav align-items-center ms-auto">
                    <!-- <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa fa-envelope me-lg-2"></i>
                            <span class="d-none d-lg-inline-flex">訊息</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">
                                <div class="d-flex align-items-center">
                                    <img class="rounded-circle" src="/static/img/user.jpg" alt="" style="width: 40px; height: 40px;">
                                    <div class="ms-2">
                                        <h6 class="fw-normal mb-0">你有新的訊息</h6>
                                        <small>15 minutes ago</small>
                                    </div>
                                </div>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <div class="d-flex align-items-center">
                                    <img class="rounded-circle" src="/static/img/user.jpg" alt="" style="width: 40px; height: 40px;">
                                    <div class="ms-2">
                                        <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                        <small>15 minutes ago</small>
                                    </div>
                                </div>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <div class="d-flex align-items-center">
                                    <img class="rounded-circle" src="/static/img/user.jpg" alt="" style="width: 40px; height: 40px;">
                                    <div class="ms-2">
                                        <h6 class="fw-normal mb-0">Jhon send you a message</h6>
                                        <small>15 minutes ago</small>
                                    </div>
                                </div>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item text-center">See all message</a>
                        </div>
                    </div> -->
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa fa-bell me-lg-2"></i>
                            <span class="d-none d-lg-inline-flex">Notificatin</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">
                                <h6 class="fw-normal mb-0">Profile updated</h6>
                                <small>15 minutes ago</small>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <h6 class="fw-normal mb-0">New user added</h6>
                                <small>15 minutes ago</small>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item">
                                <h6 class="fw-normal mb-0">Password changed</h6>
                                <small>15 minutes ago</small>
                            </a>
                            <hr class="dropdown-divider">
                            <a href="#" class="dropdown-item text-center">See all notifications</a>
                        </div>
                    </div>
                    <!-- <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                            <img class="rounded-circle me-lg-2" src="/static/img/user.jpg" alt="" style="width: 40px; height: 40px;">
                            <span class="d-none d-lg-inline-flex">John Doe</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
                            <a href="#" class="dropdown-item">My Profile</a>
                            <a href="#" class="dropdown-item">Settings</a>
                            <a href="#" class="dropdown-item">Log Out</a>
                        </div>
                    </div> -->
                </div>
            </nav>
            <!-- Navbar End -->


            <!-- Table Start -->
            <div class="container-fluid pt-4 px-4">
                <div class="row g-4">
                    <div class="col-sm-12 col-xl-6">
                        <div class="bg-secondary text-center rounded p-4" >

                            <div class="d-flex align-items-center justify-content-between mb-4">
                                <h6 class="mb-0">K_line</h6>
                                <a href="">Show All</a>
                            </div>
                            <div id="K_line" style="width: 100%;height:500px;"></div>
                        </div>
                    </div>
                    <div class="col-sm-12 col-xl-6">
                        <div class="bg-secondary text-center rounded p-4">
                            <div class="d-flex align-items-center justify-content-between mb-4">
                                <h6 class="mb-0">BBAND</h6>
                                <a href="">Show All</a>
                            </div>
                            <div id="BBAND" style="width: 100%;height:500px;"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid pt-4 px-4">
              <div class="row g-4">
                  <div class="col-sm-12 col-xl-6">
                      <div class="bg-secondary text-center rounded p-4" >

                          <div class="d-flex align-items-center justify-content-between mb-4">
                              <h6 class="mb-0">MACD</h6>
                              <a href="">Show All</a>
                          </div>
                          <div id="MACD" style="width: 100%;height:500px;"></div>
                      </div>
                  </div>
                  <div class="col-sm-12 col-xl-6">
                      <div class="bg-secondary text-center rounded p-4">
                          <div class="d-flex align-items-center justify-content-between mb-4">
                              <h6 class="mb-0">Change_MK</h6>
                              <a href="">Show All</a>
                          </div>
                          <div id="Change_MK" style="width: 100%;height:500px;"></div>
                      </div>
                  </div>
              </div>
            </div>
            <div class="container-fluid pt-4 px-4">
                <div class="row g-4">
                    <div class="col-sm-12 col-xl-6">
                        <div class="bg-secondary rounded h-100 p-4">
                            <h6 class="mb-4">Basic Table</h6>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">First Name</th>
                                        <th scope="col">Last Name</th>
                                        <th scope="col">Email</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th scope="row">1</th>
                                        <td>John</td>
                                        <td>Doe</td>
                                        <td>jhon@email.com</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">2</th>
                                        <td>Mark</td>
                                        <td>Otto</td>
                                        <td>mark@email.com</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">3</th>
                                        <td>Jacob</td>
                                        <td>Thornton</td>
                                        <td>jacob@email.com</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-sm-12 col-xl-6">
                        <div class="bg-secondary rounded h-100 p-4">
                            <h6 class="mb-4">Accented Table</h6>
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">First Name</th>
                                        <th scope="col">Last Name</th>
                                        <th scope="col">Email</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th scope="row">1</th>
                                        <td>John</td>
                                        <td>Doe</td>
                                        <td>jhon@email.com</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">2</th>
                                        <td>Mark</td>
                                        <td>Otto</td>
                                        <td>mark@email.com</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">3</th>
                                        <td>Jacob</td>
                                        <td>Thornton</td>
                                        <td>jacob@email.com</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-sm-12 col-xl-6">
                        <div class="bg-secondary rounded h-100 p-4">
                            <h6 class="mb-4">Hoverable Table</h6>
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">First Name</th>
                                        <th scope="col">Last Name</th>
                                        <th scope="col">Email</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th scope="row">1</th>
                                        <td>John</td>
                                        <td>Doe</td>
                                        <td>jhon@email.com</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">2</th>
                                        <td>Mark</td>
                                        <td>Otto</td>
                                        <td>mark@email.com</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">3</th>
                                        <td>Jacob</td>
                                        <td>Thornton</td>
                                        <td>jacob@email.com</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-sm-12 col-xl-6">
                        <div class="bg-secondary rounded h-100 p-4">
                            <h6 class="mb-4">Color Table</h6>
                            <table class="table table-dark">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">First Name</th>
                                        <th scope="col">Last Name</th>
                                        <th scope="col">Email</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th scope="row">1</th>
                                        <td>John</td>
                                        <td>Doe</td>
                                        <td>jhon@email.com</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">2</th>
                                        <td>Mark</td>
                                        <td>Otto</td>
                                        <td>mark@email.com</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">3</th>
                                        <td>Jacob</td>
                                        <td>Thornton</td>
                                        <td>jacob@email.com</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-sm-12 col-xl-6">
                        <div class="bg-secondary rounded h-100 p-4">
                            <h6 class="mb-4">Bordered Table</h6>
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">First Name</th>
                                        <th scope="col">Last Name</th>
                                        <th scope="col">Email</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th scope="row">1</th>
                                        <td>John</td>
                                        <td>Doe</td>
                                        <td>jhon@email.com</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">2</th>
                                        <td>Mark</td>
                                        <td>Otto</td>
                                        <td>mark@email.com</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">3</th>
                                        <td>Jacob</td>
                                        <td>Thornton</td>
                                        <td>jacob@email.com</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-sm-12 col-xl-6">
                        <div class="bg-secondary rounded h-100 p-4">
                            <h6 class="mb-4">Table Without Border</h6>
                            <table class="table table-borderless">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">First Name</th>
                                        <th scope="col">Last Name</th>
                                        <th scope="col">Email</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th scope="row">1</th>
                                        <td>John</td>
                                        <td>Doe</td>
                                        <td>jhon@email.com</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">2</th>
                                        <td>Mark</td>
                                        <td>Otto</td>
                                        <td>mark@email.com</td>
                                    </tr>
                                    <tr>
                                        <th scope="row">3</th>
                                        <td>Jacob</td>
                                        <td>Thornton</td>
                                        <td>jacob@email.com</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="bg-secondary rounded h-100 p-4">
                            <h6 class="mb-4">Responsive Table</h6>
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">First Name</th>
                                            <th scope="col">Last Name</th>
                                            <th scope="col">Email</th>
                                            <th scope="col">Country</th>
                                            <th scope="col">ZIP</th>
                                            <th scope="col">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <th scope="row">1</th>
                                            <td>John</td>
                                            <td>Doe</td>
                                            <td>jhon@email.com</td>
                                            <td>USA</td>
                                            <td>123</td>
                                            <td>Member</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">2</th>
                                            <td>Mark</td>
                                            <td>Otto</td>
                                            <td>mark@email.com</td>
                                            <td>UK</td>
                                            <td>456</td>
                                            <td>Member</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">3</th>
                                            <td>Jacob</td>
                                            <td>Thornton</td>
                                            <td>jacob@email.com</td>
                                            <td>AU</td>
                                            <td>789</td>
                                            <td>Member</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Table End -->


            <!-- Footer Start -->
            <div class="container-fluid pt-4 px-4">
                <div class="bg-secondary rounded-top p-4">
                    <div class="row">
                        <div class="col-12 col-sm-6 text-center text-sm-start">
                            &copy; <a href="#">Your Site Name</a>, All Right Reserved. 
                        </div>
                        <div class="col-12 col-sm-6 text-center text-sm-end">
                            <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
                            Designed By <a href="https://htmlcodex.com">HTML Codex</a>
                            <br>Distributed By: <a href="https://themewagon.com" target="_blank">ThemeWagon</a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer End -->
        </div>
        <!-- Content End -->


        <!-- Back to Top -->
        <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/lib/chart/chart.min.js"></script>
    <script src="/static/lib/easing/easing.min.js"></script>
    <script src="/static/lib/waypoints/waypoints.min.js"></script>
    <script src="/static/lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="/static/lib/tempusdominus/js/moment.min.js"></script>
    <script src="/static/lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="/static/lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Template Javascript -->
    <script src="/static/js/main.js"></script>

        <!-- 繪圖 -->
        <script type="text/javascript">
            var myChart = echarts.init(document.getElementById('K_line'), 'dark');
            // , 'dark' 為暗色版
            var option;
            
            const upColor = '#00da3c';
            const downColor = '#ec0000';
            
            // 資料預處理函式建立
            function splitData(rawData) {
                let categoryData = [];
                let values = [];
                let volumes = [];
                let name = [];
                for (let i = 0; i < rawData.length; i++) {
                    name.push(rawData[i].splice(0, 1)[0]);
                    categoryData.push(rawData[i].splice(0, 1)[0]);
                    values.push(rawData[i]);
                    volumes.push([i, rawData[i][4], rawData[i][0] > rawData[i][1] ? 1 : -1]);
                }
                return {
                    categoryData: categoryData,
                    values: values,
                    volumes: volumes,
                    name: name
                };
            }
            
            function splitData_MACD(rawData) {
                let name = [];
                let Data = [];
                let MACD_V = [];
                let MACDsignal = [];
                let MACDhist = [];
                for (let i = 0; i < rawData.length; i++) {
                    name.push(rawData[i].splice(0, 1)[0]);
                    Data.push(rawData[i].splice(0, 1)[0]);
                    MACD_V.push(rawData[i].splice(0, 1)[0]);
                    MACDsignal.push(rawData[i].splice(0, 1)[0]);
                    MACDhist.push(rawData[i].splice(0, 1)[0]);
                }
                return {
                  name: name,
                  Data: Data,
                  MACD_V: MACD_V,
                  MACDsignal: MACDsignal,
                  MACDhist: MACDhist,
                };
            }
            
            function splitData_Change_MK(rawData) {
                let name = [];
                let Data = [];
                let Change_MK = [];
            
                for (let i = 0; i < rawData.length; i++) {
                    name.push(rawData[i].splice(0, 1)[0]);
                    Data.push(rawData[i].splice(0, 1)[0]);
                    Change_MK.push(rawData[i].splice(0, 1)[0]);
                }
                return {
                  name: name,
                  Data: Data,
                  Change_MK: Change_MK,
                };
            }
            
            function splitData_BBAND(rawData) {
                let name = [];
                let categoryData = [];
                let values = [];
                let upper = [];
                let middle = [];
                let lower = [];
                for (let i = 0; i < rawData.length; i++) {
                    name.push(rawData[i].splice(0, 1)[0]);
                    categoryData.push(rawData[i].splice(0, 1)[0]);
                    upper.push(rawData[i].splice(0, 1)[0]);
                    middle.push(rawData[i].splice(0, 1)[0]);
                    lower.push(rawData[i].splice(0, 1)[0]);
                    values.push(rawData[i]);
                }
                return {
                  name: name,
                  categoryData: categoryData,
                  values: values,
                  upper: upper,
                  middle: middle,
                  lower: lower,
                };
            }
            
            
            // MA計算函式建立
            function calculateMA(dayCount, data) {
                var result = [];
                for (var i = 0, len = data.values.length; i < len; i++) {
                    if (i < dayCount) {
                        result.push('-');
                        continue;
                    }
                    var sum = 0;
                    for (var j = 0; j < dayCount; j++) {
                        sum += data.values[i - j][1];
                    }
                    result.push(+(sum / dayCount).toFixed(3));
                }
                return result;
            }
            
            // 搜尋時頁面: 將search_from取得的股票號碼連同post請求一起傳到後端，取得資料後進行繪圖
            function check_search_from(){
              if (!search_from.q.value.length){
                alert('請填 股票資訊');
                return false;
              }
              // serialize()會將表單值序列化
              $.post('/K_line', $(search_from).serialize(), function(data){
                //成功取得資料後進行資料處理
                // console.log(typeof(data));
                // 因為這邊取得的資料型態為字串，所以需要透過eval()將其轉為js物件，才可正常執行splitData()
                var data = splitData(eval(data)); 
                // console.log(data.categoryData);
                // 開始繪圖
                myChart.setOption(
                (option = {
                  backgroundColor: '#191C24',
                  animation: false,
                  legend: {
                    bottom: 10,
                    left: 'center',
                    data: [data.name[0], 'MA5', 'MA10', 'MA20', 'MA30']
                  },
                  tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                      type: 'cross'
                    },
                    borderWidth: 1,
                    borderColor: '#ccc',
                    padding: 10,
                    textStyle: {
                      color: '#000'
                    },
                    position: function (pos, params, el, elRect, size) {
                      const obj = {
                        top: 10
                      };
                      obj[['left', 'right'][+(pos[0] < size.viewSize[0] / 2)]] = 30;
                      return obj;
                    }
                    // extraCssText: 'width: 170px'
                  },
                  axisPointer: {
                    link: [
                      {
                        xAxisIndex: 'all'
                      }
                    ],
                    label: {
                      backgroundColor: '#777'
                    }
                  },
                  toolbox: {
                    feature: {
                      dataZoom: {
                        yAxisIndex: false
                      },
                      brush: {
                        type: ['lineX', 'clear']
                      }
                    }
                  },
                  brush: {
                    xAxisIndex: 'all',
                    brushLink: 'all',
                    outOfBrush: {
                      colorAlpha: 0.1
                    }
                  },
                  visualMap: {
                    show: false,
                    seriesIndex: 5,
                    dimension: 2,
                    pieces: [
                      {
                        value: 1,
                        color: downColor
                      },
                      {
                        value: -1,
                        color: upColor
                      }
                    ]
                  },
                  grid: [
                    {
                      left: '10%',
                      right: '8%',
                      height: '50%'
                    },
                    {
                      left: '10%',
                      right: '8%',
                      top: '63%',
                      height: '16%'
                    }
                  ],
                  xAxis: [
                    {
                      type: 'category',
                      data: data.categoryData,
                      boundaryGap: false,
                      axisLine: { onZero: false },
                      splitLine: { show: false },
                      min: 'dataMin',
                      max: 'dataMax',
                      axisPointer: {
                        z: 100
                      }
                    },
                    {
                      type: 'category',
                      gridIndex: 1,
                      data: data.categoryData,
                      boundaryGap: false,
                      axisLine: { onZero: false },
                      axisTick: { show: false },
                      splitLine: { show: false },
                      axisLabel: { show: false },
                      min: 'dataMin',
                      max: 'dataMax'
                    }
                  ],
                  yAxis: [
                    {
                      scale: true,
                      splitArea: {
                        show: true
                      }
                    },
                    {
                      scale: true,
                      gridIndex: 1,
                      splitNumber: 2,
                      axisLabel: { show: false },
                      axisLine: { show: false },
                      axisTick: { show: false },
                      splitLine: { show: false }
                    }
                  ],
                  // 下方橫條設定
                  dataZoom: [
                    {
                      type: 'inside',
                      xAxisIndex: [0, 1],
                      start: 50,
                      end: 100
                    },
                    {
                      show: true,
                      xAxisIndex: [0, 1],
                      type: 'slider',
                      top: '85%',
                      start: 98,
                      end: 100
                    }
                  ],
                  // 滑鼠移過時顯示的資料設定
                  series: [
                    {
                      name: data.name[0],
                      type: 'candlestick',
                      data: data.values,
                      itemStyle: {
                        color: upColor,
                        color0: downColor,
                        borderColor: undefined,
                        borderColor0: undefined
                      },
                      tooltip: {
                        formatter: function (param) {
                          param = param[0];
                          return [
                            'Date: ' + param.name + '<hr size=1 style="margin: 3px 0">',
                            'Open: ' + param.data[0] + '<br/>',
                            'Close: ' + param.data[1] + '<br/>',
                            'Lowest: ' + param.data[2] + '<br/>',
                            'Highest: ' + param.data[3] + '<br/>'
                          ].join('');
                        }
                      }
                    },
                    {
                      name: 'MA5',
                      type: 'line',
                      data: calculateMA(5, data),
                      smooth: true,
                      lineStyle: {
                        opacity: 0.5
                      }
                    },
                    {
                      name: 'MA10',
                      type: 'line',
                      data: calculateMA(10, data),
                      smooth: true,
                      lineStyle: {
                        opacity: 0.5
                      }
                    },
                    {
                      name: 'MA20',
                      type: 'line',
                      data: calculateMA(20, data),
                      smooth: true,
                      lineStyle: {
                        opacity: 0.5
                      }
                    },
                    {
                      name: 'MA30',
                      type: 'line',
                      data: calculateMA(30, data),
                      smooth: true,
                      lineStyle: {
                        opacity: 0.5
                      }
                    },
                    {
                      name: 'Volume',
                      type: 'bar',
                      xAxisIndex: 1,
                      yAxisIndex: 1,
                      data: data.volumes
                    }
                  ]
                }),
                true
              )
            
              });
              
              $.post('/MACD', $(search_from).serialize(), function(data){
                var data = splitData_MACD(eval(data));
                MACD_lin(data);
              });
              
              $.post('/Change_MK', $(search_from).serialize(), function(data){
                var data = splitData_Change_MK(eval(data));
                Change_MK_lin(data);
              });
              
              $.post('/BBAND', $(search_from).serialize(), function(data){
                var data = splitData_BBAND(eval(data));
                BBAND_lin(data);
              });
              
              
              
              // 由於已用jquery.post的方式讓表格資料回傳，所以回傳false，阻止onsubmit提交
              return false;
            }
            
            
            // 預設頁面: 發送ajax請求，從後台獲取json數據
            $(document).ready(function () {  
              getData_BBAND();
              getData_Change_MK();
              getData_MACD();
              getData_Kline();
              // console.log(app.rawData);
            });
            
            
            // 以下為K_line
            
            function getData_Kline() {
            $.ajax({
            
            url:'/K_line',
            data:{},
            type:'POST',
            async:false,
            dataType:'json',
            
            success:function(data) {
            // 成功取得資料後進行資料預處理
            // console.log(typeof(data));
            // console.log(data);
            var data = splitData(data);
            // console.log(data);
            // 開始繪圖
            myChart.setOption(
                (option = {
                  
                  animation: false,
                  // title: {
                  //   text: 'K_line'
                  // },
                  legend: {
                    bottom: 10,
                    left: 'center',
                    data: [data.name[0], 'MA5', 'MA10', 'MA20', 'MA30']
                  },
                  tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                      type: 'cross'
                    },
                    borderWidth: 1,
                    borderColor: '#ccc',
                    padding: 10,
                    textStyle: {
                      color: '#000'
                    },
                    position: function (pos, params, el, elRect, size) {
                      const obj = {
                        top: 10
                      };
                      obj[['left', 'right'][+(pos[0] < size.viewSize[0] / 2)]] = 30;
                      return obj;
                    }
                    // extraCssText: 'width: 170px'
                  },
                  axisPointer: {
                    link: [
                      {
                        xAxisIndex: 'all'
                      }
                    ],
                    label: {
                      backgroundColor: '#777'
                    }
                  },
                  toolbox: {
                    feature: {
                      dataZoom: {
                        yAxisIndex: false
                      },
                      brush: {
                        type: ['lineX', 'clear']
                      }
                    }
                  },
                  brush: {
                    xAxisIndex: 'all',
                    brushLink: 'all',
                    outOfBrush: {
                      colorAlpha: 0.1
                    }
                  },
                  visualMap: {
                    show: false,
                    seriesIndex: 5,
                    dimension: 2,
                    pieces: [
                      {
                        value: 1,
                        color: downColor
                      },
                      {
                        value: -1,
                        color: upColor
                      }
                    ]
                  },
                  grid: [
                    {
                      left: '10%',
                      right: '8%',
                      height: '50%'
                    },
                    {
                      left: '10%',
                      right: '8%',
                      top: '63%',
                      height: '16%'
                    }
                  ],
                  xAxis: [
                    {
                      type: 'category',
                      data: data.categoryData,
                      boundaryGap: false,
                      axisLine: { onZero: false },
                      splitLine: { show: false },
                      min: 'dataMin',
                      max: 'dataMax',
                      axisPointer: {
                        z: 100
                      }
                    },
                    {
                      type: 'category',
                      gridIndex: 1,
                      data: data.categoryData,
                      boundaryGap: false,
                      axisLine: { onZero: false },
                      axisTick: { show: false },
                      splitLine: { show: false },
                      axisLabel: { show: false },
                      min: 'dataMin',
                      max: 'dataMax'
                    }
                  ],
                  yAxis: [
                    {
                      scale: true,
                      splitArea: {
                        show: true
                      }
                    },
                    {
                      scale: true,
                      gridIndex: 1,
                      splitNumber: 2,
                      axisLabel: { show: false },
                      axisLine: { show: false },
                      axisTick: { show: false },
                      splitLine: { show: false }
                    }
                  ],
                  // 下方橫條設定
                  dataZoom: [
                    {
                      type: 'inside',
                      xAxisIndex: [0, 1],
                      start: 50,
                      end: 100
                    },
                    {
                      show: true,
                      xAxisIndex: [0, 1],
                      type: 'slider',
                      top: '85%',
                      start: 98,
                      end: 100
                    }
                  ],
                  // 滑鼠移過時顯示的資料設定
                  series: [
                    {
                      name: data.name[0],
                      type: 'candlestick',
                      data: data.values,
                      itemStyle: {
                        color: upColor,
                        color0: downColor,
                        borderColor: undefined,
                        borderColor0: undefined
                      },
                      tooltip: {
                        formatter: function (param) {
                          param = param[0];
                          return [
                            'Date: ' + param.name + '<hr size=1 style="margin: 3px 0">',
                            'Open: ' + param.data[0] + '<br/>',
                            'Close: ' + param.data[1] + '<br/>',
                            'Lowest: ' + param.data[2] + '<br/>',
                            'Highest: ' + param.data[3] + '<br/>'
                          ].join('');
                        }
                      }
                    },
                    {
                      name: 'MA5',
                      type: 'line',
                      data: calculateMA(5, data),
                      smooth: true,
                      lineStyle: {
                        opacity: 0.5
                      }
                    },
                    {
                      name: 'MA10',
                      type: 'line',
                      data: calculateMA(10, data),
                      smooth: true,
                      lineStyle: {
                        opacity: 0.5
                      }
                    },
                    {
                      name: 'MA20',
                      type: 'line',
                      data: calculateMA(20, data),
                      smooth: true,
                      lineStyle: {
                        opacity: 0.5
                      }
                    },
                    {
                      name: 'MA30',
                      type: 'line',
                      data: calculateMA(30, data),
                      smooth: true,
                      lineStyle: {
                        opacity: 0.5
                      }
                    },
                    {
                      name: 'Volume',
                      type: 'bar',
                      xAxisIndex: 1,
                      yAxisIndex: 1,
                      data: data.volumes
                    }
                  ],
                backgroundColor: '#191C24',
                }),
                true
              )
            
            },
            error:function (msg) {
            console.log(msg);
            alert('系統發生錯誤');
            }
            })
            };
            // setInterval(getData,10000); //自動輪尋，10秒一次，動態刷新(先不要開，電腦撐不住)
            
            
            // 以下為MACD
            
            var chartDom = document.getElementById('MACD');
            var MACD = echarts.init(chartDom, 'dark');
            var option;
            
            
            function getData_MACD() {
            $.ajax({
            
            url:'/MACD',
            data:{},
            type:'POST',
            async:false,
            dataType:'json',
            
            success:function(data) {
            // 成功取得資料後進行資料預處理
            var data = splitData_MACD(data);
            // console.log(typeof(data));
            // console.log(data.Data);
            // console.log(data.MACD_V);
            // console.log(data.MACDsignal);
            // console.log(data.MACDhist);
            // console.log(data);
            // console.log(data);
            // 開始繪圖
            MACD_lin(data);
            MACD.setOption(option);
            
            },
            error:function (msg) {
            console.log(msg);
            alert('系統發生錯誤');
            }
            })
            };
            
            function MACD_lin(_rawData) {
              option = {
              backgroundColor: '#191C24',
              // title: {
              //   text: 'MACD'
              // },
              tooltip: {
                trigger: 'axis'
              },
              legend: {
                data: ['MACD', 'MACDhist', 'MACDsignal']
              },
              grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
              },
              toolbox: {
                feature: {
                  saveAsImage: {}
                }
              },
              xAxis: {
                type: 'category',
                boundaryGap: false,
                data: _rawData.Data,
                axisLine: { onZero: false },
                splitLine: { show: false },
                min: 'dataMin',
                max: 'dataMax',
                axisPointer: {
                  z: 100
                }
              },
              yAxis: {
                type: 'value'
              },
              series: [
                {
                  name: 'MACD',
                  type: 'line',
                  stack: 'Total',
                  data: _rawData.MACD_V,
                },
                {
                  name: 'MACDhist',
                  type: 'line',
                  stack: 'Total',
                  data: _rawData.MACDhist,
                },
                {
                  name: 'MACDsignal',
                  type: 'line',
                  stack: 'Total',
                  data: _rawData.MACDsignal,
                }
              ],
              backgroundColor: '#191C24',
            };
              
            }
            option && MACD.setOption(option);
            
            
            // 以下為Change_MK
            
            var chartDom = document.getElementById('Change_MK');
            var Change_MK = echarts.init(chartDom, 'dark');
            var option;
            
            
            function getData_Change_MK() {
            $.ajax({
            
            url:'/Change_MK',
            data:{},
            type:'POST',
            async:false,
            dataType:'json',
            
            success:function(data) {
            // 成功取得資料後進行資料預處理
            var data = splitData_Change_MK(data);
    
            // 開始繪圖
            Change_MK_lin(data);
            Change_MK.setOption(option);
            },
            error:function (msg) {
            console.log(msg);
            alert('系統發生錯誤');
            }
            
            
            })
            };
            
            function Change_MK_lin(_rawData) {
              
              option = {
              backgroundColor: '#191C24',
              // title: {
              //   text: 'Change_MK'
              // },
              tooltip: {
                trigger: 'axis'
              },
              legend: {
                data: ['Change_MK']
              },
              grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
              },
              toolbox: {
                feature: {
                  saveAsImage: {}
                }
              },
              xAxis: {
                type: 'category',
                boundaryGap: false,
                data: _rawData.Data,
                axisLine: { onZero: false },
                splitLine: { show: false },
                min: 'dataMin',
                max: 'dataMax',
                axisPointer: {
                  z: 100
                }
              },
              yAxis: {
                type: 'value'
              },
              series: [
                {
                  name: 'Change_MK',
                  type: 'line',
                  stack: 'Total',
                  data: _rawData.Change_MK,
                }
              ]
            };
              
            }
            option && Change_MK.setOption(option);
            
            
            // 以下為BBAND
            
            var chartDom = document.getElementById('BBAND');
            var BBAND = echarts.init(chartDom, 'dark');
            var option;
            
            
            function getData_BBAND() {
            $.ajax({
            
            url:'/BBAND',
            data:{},
            type:'POST',
            async:false,
            dataType:'json',
            
            success:function(data) {
            // 成功取得資料後進行資料預處理
            var data = splitData_BBAND(data);
            console.log(typeof(data));
            console.log(data);
            console.log(data.value);
            
            // 開始繪圖
            BBAND_lin(data);
            BBAND.setOption(option);
          },
            error:function (msg) {
            console.log(msg);
            alert('系統發生錯誤');
            }
            })
            };
            
            function BBAND_lin(data) {
              option = {
                  animation: false,
                  // title: {
                  //   text: 'BBAND'
                  // },
                  backgroundColor: '#191C24',
                  legend: {
                    bottom: 10,
                    left: 'center',
                    data: [data.name[0], 'upper', 'middle', 'lower']
                  },
                  tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                      type: 'cross'
                    },
                    borderWidth: 1,
                    borderColor: '#ccc',
                    padding: 10,
                    textStyle: {
                      color: '#000'
                    },
                    position: function (pos, params, el, elRect, size) {
                      const obj = {
                        top: 10
                      };
                      obj[['left', 'right'][+(pos[0] < size.viewSize[0] / 2)]] = 30;
                      return obj;
                    }
                    // extraCssText: 'width: 170px'
                  },
                  axisPointer: {
                    link: [
                      {
                        xAxisIndex: 'all'
                      }
                    ],
                    label: {
                      backgroundColor: '#777'
                    }
                  },
                  toolbox: {
                    feature: {
                      dataZoom: {
                        yAxisIndex: false
                      },
                      brush: {
                        type: ['lineX', 'clear']
                      }
                    }
                  },
                  brush: {
                    xAxisIndex: 'all',
                    brushLink: 'all',
                    outOfBrush: {
                      colorAlpha: 0.1
                    }
                  },
                  visualMap: {
                    show: false,
                    seriesIndex: 5,
                    dimension: 2,
                    pieces: [
                      {
                        value: 1,
                        color: downColor,
                      },
                      {
                        value: -1,
                        color: upColor,
            
                      }
                    ],
            
                  },
                  grid: [
                    {
                      left: '10%',
                      right: '8%',
                      height: '50%'
                    },
                    {
                      left: '10%',
                      right: '8%',
                      top: '63%',
                      height: '16%'
                    }
                  ],
                  xAxis: [
                    {
                      type: 'category',
                      data: data.categoryData,
                      boundaryGap: false,
                      axisLine: { onZero: false },
                      splitLine: { show: false },
                      min: 'dataMin',
                      max: 'dataMax',
                      axisPointer: {
                        z: 100
                      }
                    },
                    {
                      type: 'category',
                      gridIndex: 1,
                      data: data.categoryData,
                      boundaryGap: false,
                      axisLine: { onZero: false },
                      axisTick: { show: false },
                      splitLine: { show: false },
                      axisLabel: { show: false },
                      min: 'dataMin',
                      max: 'dataMax'
                    }
                  ],
                  yAxis: [
                    {
                      scale: true,
                      splitArea: {
                        show: true
                      }
                    },
                    {
                      scale: true,
                      gridIndex: 1,
                      splitNumber: 2,
                      axisLabel: { show: false },
                      axisLine: { show: false },
                      axisTick: { show: false },
                      splitLine: { show: false }
                    }
                  ],
                  // 下方橫條設定
                  dataZoom: [
                    {
                      type: 'inside',
                      xAxisIndex: [0, 1],
                      start: 50,
                      end: 100
                    },
                    {
                      show: true,
                      xAxisIndex: [0, 1],
                      type: 'slider',
                      top: '85%',
                      start: 98,
                      end: 100
                    }
                  ],
                  // 滑鼠移過時顯示的資料設定
                  series: [
                    {
                      name: data.name[0],
                      type: 'candlestick',
                      data: data.values,
                      itemStyle: {
                        color: upColor,
                        color0: downColor,
                        borderColor: undefined,
                        borderColor0: undefined,
                        opacity: 0.4
                      },
                      tooltip: {
                        formatter: function (param) {
                          param = param[0];
                          return [
                            'Date: ' + param.name + '<hr size=1 style="margin: 3px 0">',
                            'Open: ' + param.data[0] + '<br/>',
                            'Close: ' + param.data[1] + '<br/>',
                            'Lowest: ' + param.data[2] + '<br/>',
                            'Highest: ' + param.data[3] + '<br/>'
                          ].join('');
                        }
                      }
                    },
                    {
                      name: 'upper',
                      type: 'line',
                      data: data.upper,
                      // smooth: true,
                      lineStyle: {
                        opacity: 1
                      }
                    },
                    {
                      name: 'middle',
                      type: 'line',
                      data: data.middle,
                      // smooth: true,
                      lineStyle: {
                        opacity: 1
                      }
                    },
                    {
                      name: 'lower',
                      type: 'line',
                      data: data.lower,
                      // smooth: true,
                      lineStyle: {
                        opacity: 1,
                        type:'solid'
                      }
                    },
                    // {
                    //   name: 'Volume',
                    //   type: 'bar',
                    //   xAxisIndex: 1,
                    //   yAxisIndex: 1,
                    //   data: data.volumes
                    // }
                  ]
                };
              
            }
            option && BBAND.setOption(option);
            
            
        </script>
</body>

</html>